<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>IO模型 | 默刀</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-113714645-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">IO模型</h1><a id="logo" href="/.">默刀</a><p class="description">Study as if you were to live forever, live as if you were to die tomorrow.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">IO模型</h1><div class="post-meta">May 16, 2018<span> | </span><span class="category"><a href="/categories/IO/">IO</a></span></div><div class="post-content"><h3 id="常用的四种IO模型："><a href="#常用的四种IO模型：" class="headerlink" title="常用的四种IO模型："></a>常用的四种IO模型：</h3><h4 id="1）blocking-IO（阻塞IO模型）"><a href="#1）blocking-IO（阻塞IO模型）" class="headerlink" title="1）blocking IO（阻塞IO模型）"></a>1）blocking IO（阻塞IO模型）</h4><p>客户端需要等待服务端返回数据，整个过程是串行的</p>
<h4 id="2）non-blocking-IO-非阻塞IO"><a href="#2）non-blocking-IO-非阻塞IO" class="headerlink" title="2）non-blocking IO(非阻塞IO)"></a>2）non-blocking IO(非阻塞IO)</h4><p>服务端立即相应客户端，数据没有准备好就返回Error，客户端需要轮询服务端获取想要的数据，直到数据准备好并返回</p>
<h4 id="3）IO-multiplexing（IO多路复用）"><a href="#3）IO-multiplexing（IO多路复用）" class="headerlink" title="3）IO multiplexing（IO多路复用）"></a>3）IO multiplexing（IO多路复用）</h4><p>IO多路复用的三种方式：</p>
<ul>
<li>1、select效率最低，但有最大描述符限制，在linux为1024。</li>
<li>2、poll和select一样，但没有最大描述符限制。</li>
<li>3、epoll效率最高，没有最大描述符限制，支持水平触发与边缘触发。</li>
</ul>
<p><strong>IO多路复用的优势</strong>：同时可以监听多个连接，用的是单线程，利用空闲时间实现并发。</p>
<h4 id="4）Asynchronous-I-O（异步IO）"><a href="#4）Asynchronous-I-O（异步IO）" class="headerlink" title="4）Asynchronous I/O（异步IO）"></a>4）Asynchronous I/O（异步IO）</h4><p>用户进程发起read操作之后，立刻就可以开始去做其它的事。而另一方面，从kernel的角度，当它受到一个asynchronous read之后，首先它会立刻返回，所以不会对用户进程产生任何block。然后，kernel会等待数据准备完成，然后将数据拷贝到用户内存，当这一切都完成之后，kernel会给用户进程发送一个signal，告诉它read操作完成了。<br>异步最大特点：全程无阻塞</p>
<p><strong> 同步IO </strong> ：包括 blocking IO、non-blocking、select、poll、epoll（故:epool只是伪异步而已）（有阻塞）<br><strong> 异步IO </strong> ：包括:asynchronous  （无阻塞）</p>
<h3 id="sellect、poll、epoll三者的区别"><a href="#sellect、poll、epoll三者的区别" class="headerlink" title="sellect、poll、epoll三者的区别 :"></a>sellect、poll、epoll三者的区别 :</h3><h4 id="select："><a href="#select：" class="headerlink" title="select："></a>select：</h4><ul>
<li>目前支持几乎所有的平台，默认单个进程能够监视的文件描述符的数量存在最大限制，在linux上默认只支持1024个socket，可以通过修改宏定义或重新编译内核（修改系统最大支持的端口数）的方式提升这一限制。</li>
<li>内核准备好数据后通知用户有数据了，但内核不告诉用户是哪个连接有数据，用户只能通过轮询的方式来获取数据，假定select让内核监视100个socket连接，当有1个连接有数据后，内核就通知用户100个连接中有数据了，但是不告诉用户是哪个连接有数据了，此时用户只能通过轮询的方式一个个去检查然后获取数据，那么如果有上万个，十万个连接，那就得轮询上万次，上十万次，而所取的结果仅仅就那么1个，这样就会浪费很多系统开销</li>
<li>只支持水平触发</li>
<li><p>每次调用select，都需要把fd集合从用户态拷贝到内核态，这个开销在fd很多时会很大</p>
<h4 id="poll："><a href="#poll：" class="headerlink" title="poll："></a>poll：</h4></li>
<li><p>与select没有本质上的差别，仅仅是没有了最大文件描述符数量的限制</p>
</li>
<li>只支持水平触发</li>
<li>只是一个过渡版本，很少用</li>
</ul>
<h4 id="epoll："><a href="#epoll：" class="headerlink" title="epoll："></a>epoll：</h4><ul>
<li>Linux2.6才出现epoll，具备了select和poll的一切优点，公认为性能最好的多路IO就绪通知方法，没有最大文件描述符数量的限制，不支持windows平台</li>
<li>内核准备好数据以后会通知用户哪个连接有数据了，IO效率不随fd数目增加而线性下降</li>
<li>同时支持水平触发和边缘触发</li>
<li>使用mmap加速内核与用户空间的消息传递（内存零拷贝）</li>
</ul>
<h3 id="水平触发与边缘触发："><a href="#水平触发与边缘触发：" class="headerlink" title="水平触发与边缘触发："></a>水平触发与边缘触发：</h3><p><strong> 水平触发：</strong> 将就绪的文件描述符告诉进程后，如果进程没有对其进行IO操作，那么下次调用epoll时将再次报告这些文件描述符，这种方式称为水平触发</p>
<p><strong> 边缘触发：</strong> 只告诉进程哪些文件描述符刚刚变为就绪状态，它只说一遍，如果我们没有采取行动，那么它将不会再次告知，这种方式称为边缘触发</p>
<h3 id="select和epoll的特点："><a href="#select和epoll的特点：" class="headerlink" title="select和epoll的特点："></a>select和epoll的特点：</h3><h4 id="select：-1"><a href="#select：-1" class="headerlink" title="select："></a>select：</h4><p>select通过一个select()系统调用来监视多个文件描述符的数组，当select()返回后，该数组中就绪的文件描述符便会被内核修改标志位，使得进程可以获得这些文件描述符从而进行后续的读写操作。由于网络响应时间的延迟使得大量TCP连接处于非活跃状态，但调用select()会对所有socket进行一次线性扫描，所以这也浪费了一定的开销。</p>
<h4 id="epoll：-1"><a href="#epoll：-1" class="headerlink" title="epoll："></a>epoll：</h4><ul>
<li>epoll同样只告知那些就绪的文件描述符，而且当我们调用epoll_wait()获得就绪文件描述符时，返回的不是实际的描述符，而是一个代表就绪描述符数量的值，你只需要去epoll指定的一个数组中依次取得相应数量的文件描述符即可，这里也使用了内存映射（mmap）技术，这样便彻底省掉了这些文件描述符在系统调用时复制的开销。</li>
<li><p>另一个本质的改进在于epoll采用基于事件的就绪通知方式。在select/poll中，进程只有在调用一定的方法后，内核才对所有监视的文件描述符进行扫描，而epoll事先通过epoll_ctl()来注册一个文件描述符，一旦基于某个文件描述符就绪时，内核会采用类似callback的回调机制，迅速激活这个文件描述符，当进程调用epoll_wait()时便得到通知。</p>
</li>
<li><p>select和poll都需要在返回后，通过遍历所有文件描述符来获取已经就绪的socket。事实上，同时连接的大量客户端在一时刻可能只有很少的处于就绪状态，因此随着监视的描述符数量的增长，其效率也会线性下降。</p>
</li>
</ul>
</div><div class="tags"><a href="/tags/Blocking/">Blocking</a><a href="/tags/IO/">IO</a><a href="/tags/同步/">同步</a><a href="/tags/异步/">异步</a></div><div class="post-nav"><a class="next" href="/2018/04/13/pangu/">阿里云分布式存储系统的研究与分享</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'polarisary',
  repo: 'polarisary.github.io',
  oauth: {
    client_id: 'cc1c26fba7cb369cd10b',
    client_secret: '3300c5f614b65a2505151ad18b7268ac0997986b',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><iframe width="100%" height="120" style="margin-bottom: 20px;" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=400&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2029904011&verifier=8ceb4535&dpc=1"></iframe><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://polarisary.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTTP/">HTTP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IO/">IO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/pip/" style="font-size: 15px;">pip</a> <a href="/tags/总结/" style="font-size: 15px;">总结</a> <a href="/tags/多列索引/" style="font-size: 15px;">多列索引</a> <a href="/tags/单列索引/" style="font-size: 15px;">单列索引</a> <a href="/tags/MVCC/" style="font-size: 15px;">MVCC</a> <a href="/tags/B-Tree/" style="font-size: 15px;">B-Tree</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/加密/" style="font-size: 15px;">加密</a> <a href="/tags/Blocking/" style="font-size: 15px;">Blocking</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/同步/" style="font-size: 15px;">同步</a> <a href="/tags/异步/" style="font-size: 15px;">异步</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/打包/" style="font-size: 15px;">打包</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/系统设计/" style="font-size: 15px;">系统设计</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/冒泡/" style="font-size: 15px;">冒泡</a> <a href="/tags/unity/" style="font-size: 15px;">unity</a> <a href="/tags/shader/" style="font-size: 15px;">shader</a> <a href="/tags/渲染流水线/" style="font-size: 15px;">渲染流水线</a> <a href="/tags/光照模型/" style="font-size: 15px;">光照模型</a> <a href="/tags/快排/" style="font-size: 15px;">快排</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/TC/" style="font-size: 15px;">TC</a> <a href="/tags/QOS/" style="font-size: 15px;">QOS</a> <a href="/tags/Zen/" style="font-size: 15px;">Zen</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/05/16/io-model/">IO模型</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/13/pangu/">阿里云分布式存储系统的研究与分享</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/27/tc/">Linux TC限流</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/08/python-web/">Python Web流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/02/http/">HTTP协议简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/31/MySQL索引补充/">MySQL单列索引和多列索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/MySql索引/">MySql索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/MySql概述/">MySql概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/06/mysql-lock/">mysql_lock</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/02/2017年度总结/">2017年度总结</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://coolshell.cn/" title="CoolShell" target="_blank">CoolShell</a><ul></ul><a href="http://ifeve.com/" title="并发编程" target="_blank">并发编程</a><ul></ul><a href="http://www.raychase.net/" title="四火的唠叨" target="_blank">四火的唠叨</a><ul></ul><a href="http://blog.chenpeng.info/" title="陈鹏个人博客" target="_blank">陈鹏个人博客</a><ul></ul><a href="http://www.coderli.com/" title="OneCoder" target="_blank">OneCoder</a><ul></ul><a href="http://vimer.me/" title="Vimer.me" target="_blank">Vimer.me</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">默刀.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>