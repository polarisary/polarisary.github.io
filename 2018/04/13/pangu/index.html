<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/128.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/32.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/16.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="云计算介绍云计算是一种弹性的计算模式，以虚拟化为基础，以网络为中心，为用户提供安全、快速、便捷的数据存储和网络计算服务， 包括所需要的硬件、平台、软件及服务等资源，而提供资源的网络就被称为“云”。达到让用户像使用水、电、煤气等资源一样便捷、高效。服务类型：  IaaS（基础设施即服务） PaaS（平台即服务） SaaS（软件即服务） FaaS（函数即服务）  阿里云计算阿里云计算主要围绕下面几个方">
<meta name="keywords" content="分布式,系统设计">
<meta property="og:type" content="article">
<meta property="og:title" content="阿里云分布式存储系统的研究与分享">
<meta property="og:url" content="http://blog.7street.top/2018/04/13/pangu/index.html">
<meta property="og:site_name" content="默刀">
<meta property="og:description" content="云计算介绍云计算是一种弹性的计算模式，以虚拟化为基础，以网络为中心，为用户提供安全、快速、便捷的数据存储和网络计算服务， 包括所需要的硬件、平台、软件及服务等资源，而提供资源的网络就被称为“云”。达到让用户像使用水、电、煤气等资源一样便捷、高效。服务类型：  IaaS（基础设施即服务） PaaS（平台即服务） SaaS（软件即服务） FaaS（函数即服务）  阿里云计算阿里云计算主要围绕下面几个方">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/飞天.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/阿里云基础数据存储产品.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/块存储.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/表格存储架构图.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/表格存储内部设计.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/表格存储failover.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/表格存储自动分裂.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/盘古10架构图.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/HDFS_Federation.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/主从高可用.png">
<meta property="og:image" content="http://blog.7street.top/2018/04/13/pangu/盘古paxos.png">
<meta property="og:updated_time" content="2018-04-26T08:56:27.949Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿里云分布式存储系统的研究与分享">
<meta name="twitter:description" content="云计算介绍云计算是一种弹性的计算模式，以虚拟化为基础，以网络为中心，为用户提供安全、快速、便捷的数据存储和网络计算服务， 包括所需要的硬件、平台、软件及服务等资源，而提供资源的网络就被称为“云”。达到让用户像使用水、电、煤气等资源一样便捷、高效。服务类型：  IaaS（基础设施即服务） PaaS（平台即服务） SaaS（软件即服务） FaaS（函数即服务）  阿里云计算阿里云计算主要围绕下面几个方">
<meta name="twitter:image" content="http://blog.7street.top/2018/04/13/pangu/飞天.png">






  <link rel="canonical" href="http://blog.7street.top/2018/04/13/pangu/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>阿里云分布式存储系统的研究与分享 | 默刀</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113714645-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113714645-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <!-- <span class="logo-line-before"><i></i></span> -->
        <span class="site-title">默刀</span>
        <!-- <span class="logo-line-after"><i></i></span> -->
      </a>
    </div>
    
      
        <p class="site-subtitle">Study as if you were to live forever, live as if you were to die tomorrow.</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-resume">
    <a href="/resume/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-address-card-o"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-book"></i> <br />读书</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.7street.top/2018/04/13/pangu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="默刀">
      <meta itemprop="description" content="潜心积累、野蛮成长">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="默刀">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">阿里云分布式存储系统的研究与分享
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-04-13 21:08:17" itemprop="dateCreated datePublished" datetime="2018-04-13T21:08:17+08:00">2018-04-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-04-26 16:56:27" itemprop="dateModified" datetime="2018-04-26T16:56:27+08:00">2018-04-26</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/分布式/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/13/pangu/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/13/pangu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="云计算介绍"><a href="#云计算介绍" class="headerlink" title="云计算介绍"></a>云计算介绍</h3><p>云计算是一种弹性的计算模式，以虚拟化为基础，以网络为中心，为用户提供安全、快速、便捷的数据存储和网络计算服务， 包括所需要的硬件、平台、软件及服务等资源，而提供资源的网络就被称为“云”。<br>达到让用户像使用水、电、煤气等资源一样便捷、高效。<br>服务类型：</p>
<ul>
<li>IaaS（基础设施即服务）</li>
<li>PaaS（平台即服务）</li>
<li>SaaS（软件即服务）</li>
<li>FaaS（函数即服务）</li>
</ul>
<h3 id="阿里云计算"><a href="#阿里云计算" class="headerlink" title="阿里云计算"></a>阿里云计算</h3><p>阿里云计算主要围绕下面几个方面提供服务</p>
<ul>
<li>虚拟化<br>主要对应的阿里云产品是弹性计算，包括弹性计算服务ECS、弹性伸缩、容器服务、函数计算等等</li>
<li>存储&amp;数据库<br>主要是分布式存储，包括块存储、文件存储、CDN、RDS、OceanBase等等</li>
<li>网络<br>包括负责均衡SLB、VPC、NAT网关、高速通道等等</li>
<li>安全<br>包括DDoS 基础防护、云防火墙、堡垒机等等</li>
<li>大数据应用及分析<br>MaxCompute、流计算、EMR、推荐引擎、机器学习、图像识别、自然语言处理等等</li>
<li>中间件<br>包括消息服务、日志服务、搜索服务、云服务总线CSB、应用配置管理等等</li>
<li>管理与工具<br>计费计量、云监控、资源编排、访问控制RAM等等</li>
</ul>
<h3 id="飞天开发平台"><a href="#飞天开发平台" class="headerlink" title="飞天开发平台"></a>飞天开发平台</h3><p><img src="/2018/04/13/pangu/飞天.png" alt="阿里飞天分布式平台"><br>飞天—阿里云计算核心平台，支撑了阿里云弹性计算、中间件、网络、数据库、大数据存储、大数据计算等服务。<br>从设计图上可以看出，他包括盘古、伏羲、神农等等几个核心子系统。<br>我们今天主要介绍盘古分布式存储系统，和在他之上的产品（主要是表格存储）的设计和实现</p>
<h3 id="分布式存储"><a href="#分布式存储" class="headerlink" title="分布式存储"></a>分布式存储</h3><p><strong> 定义：</strong><br>使用大量普通 PC 服务器通过网络互联，对外作为一个整体提供存储服务。<br><strong> 存储的数据类型分类：</strong></p>
<ul>
<li>分布式文件系统<br>通常作为分布式表格、分布式数据库的底层存储；常见的AWS Dynamo，Google GFS等</li>
<li>分布式key-value系统<br>主要存储关系简单的半结构化数据，只提供基于主键的CRUD。是分布式表格的一种简化实现，一般用作缓存</li>
<li>分布式表格系统<br>阿里云的TableStore</li>
<li>分布式数据库<br>阿里云OceanBase、HBase等</li>
</ul>
<h3 id="数据存储产品"><a href="#数据存储产品" class="headerlink" title="数据存储产品"></a>数据存储产品</h3><p><img src="/2018/04/13/pangu/阿里云基础数据存储产品.png" alt="阿里云基础数据存储产品"><br>共享块存储支持将一个共享块存储挂载到多个ECS上，这个可以解决我们之前去重模块跟etl必须在一台机器上部署的问题。<br>目前在阿里云上大概有三种方式解决：</p>
<ul>
<li>1.通过共享块存储</li>
<li>2.通过NAS</li>
<li>3.通过云存储网关，本质上是通过NFS协议使用OSS来实现</li>
</ul>
<h3 id="弹性块存储EBS"><a href="#弹性块存储EBS" class="headerlink" title="弹性块存储EBS"></a>弹性块存储EBS</h3><p>弹性块存储是阿里云为ECS云服务器提供的块设备，高性能、低时延，满足随机读写，可以像使用物理硬盘一样格式化、创建文件系统。可用于大部分通用业务场景下的数据存储。<br>主要产品：各种云盘<br><img src="/2018/04/13/pangu/块存储.png" alt="块存储"><br>从设计图上可以看出EBS是在盘古的基础上开发了一个块存储网关。<br><strong> 块存储网关主要功能：</strong></p>
<ul>
<li>一是负责磁盘虚拟化：将后端盘古存储空间映射为本地盘（我们在阿里云上使用的ECS，是通过虚拟化的方式使用宿主机的cpu、内存、存储等等，这个有兴趣的话可以研究下）</li>
<li>二是存储协议转换：IO请求转发到盘古Client</li>
</ul>
<h3 id="表格存储TableStore"><a href="#表格存储TableStore" class="headerlink" title="表格存储TableStore"></a>表格存储TableStore</h3><p>表格存储是构建在阿里云飞天分布式系统之上的 NoSQL 数据存储服务，提供海量结构化数据的存储和实时访问。<br>表格存储以实例和表的形式组织数据，通过数据分片和负载均衡，达到规模的无缝扩展。<br>表格存储向应用程序屏蔽底层硬件平台的故障和错误，能自动从各类错误中快速恢复，提供非常高的服务可用性。<br>表格存储管理的数据全部存储在 SSD 中并具有多个备份，提供了快速的访问性能和极高的数据可靠性。</p>
<p><strong> 表格存储核心竞争力 </strong></p>
<ul>
<li>大数据模型<ul>
<li>分布式 + LSM(Log Structured Merge Trees)存储引擎：水平扩展，海量存储，高吞吐写入能力</li>
<li>动态负载均衡，热点快速迁移</li>
<li>自动连续分裂</li>
<li>读写性能不受并发及数据存储规模影响</li>
<li>数据生命周期</li>
</ul>
</li>
<li>完善的数据通道<ul>
<li>离线全量通道（CDP）：对接离线计算引擎，数据分层</li>
<li>实时增量通道（DTS）：对接实时计算或搜索引擎，增量同步</li>
</ul>
</li>
<li>存储与计算结合<ul>
<li>打通在线存储、离线计算和实时分析的数据闭环</li>
</ul>
</li>
<li>容灾<ul>
<li>同城双集群、两地三中心和单元化</li>
</ul>
</li>
<li>成本优化<ul>
<li>计算成本：按量付费，资源包</li>
<li>存储成本：低存储成本容量型实例，分级存储，优化压缩</li>
</ul>
</li>
</ul>
<h3 id="表格存储系统架构"><a href="#表格存储系统架构" class="headerlink" title="表格存储系统架构"></a>表格存储系统架构</h3><p><img src="/2018/04/13/pangu/表格存储架构图.png" alt="表格存储架构图"><br>首先是用户层，我们使用的SDK，系统将用户使用SDK的请求通过SLB分发到多个Proxy（其实是内部的Client）上，这里实现Proxy的高可用。<br>然后Proxy与TableMaster和TableWorker交互，完成用户请求。<br>TableMaster和TableWorker、盘古、伏羲后面会有介绍</p>
<p><img src="/2018/04/13/pangu/表格存储内部设计.png" alt="表格存储内部设计"></p>
<ul>
<li>Proxy：负责鉴权及Meta数据缓存，协议转换等</li>
<li>Master：<br>负责表级的元数据管理，建表、删表；分片的调度；自动的分片、负载均衡（将不同分片调度到空闲的TableWorker来加载）；容错等</li>
<li>Table Worker：<br>主要负责分区数据加载，读写数据、行锁等。为了提高性能，内部也会维护一个缓存（这个后面会介绍）</li>
</ul>
<p>接着是存储子系统盘古和调度子系统伏羲：</p>
<ul>
<li>1.表格存储的数据实际是在盘古，由盘古来提供数据的可靠存储，后面有盘古的介绍，这里不展开。</li>
<li>2.调度子系统伏羲 配合TableMaster做调度，伏羲知道集群中机器的负载情况，协助TableMaster做调度。</li>
</ul>
<p>从这个图可以看出表格存储&amp;盘古的整体设计有点类似ceph的设计，TableMaster和盘古可独立扩展。</p>
<h3 id="表格存储高可用—Failover"><a href="#表格存储高可用—Failover" class="headerlink" title="表格存储高可用—Failover"></a>表格存储高可用—Failover</h3><p><img src="/2018/04/13/pangu/表格存储failover.png" alt="表格存储failover"><br><strong> Master Failover： </strong><br>由于表格存储的元数据是存储在盘古上的，所以数据容量 原则上是没有限制的（扩展性问题）。也由于盘古提供的可靠共享存储，表格存储的Master可以做到无状态，这样就比较容易的实现高可用。</p>
<p>从这个图上可以看出，Master进程Crash或者机器宕机是由伏羲负责拉起，然后收集分区加载信息，但这样可能会有一段时间的不可用（咨询了表格存储的技术支持，可能是在对外的资料中隐藏了一些技术细节，但他说的小集群3个Master，大集群5个Master，在加上使用的是盘古共享存储，猜测这里应该跟HDFS的NameNode一样，使用zookeeper选主实现Master高可用）。</p>
<p><strong> Table Worker Failover： </strong><br>由于元数据存储在盘古上，所以当Table Worker宕掉后，分区可以直接由新的Table Worker来加载</p>
<h3 id="表格存储高性能-自动连续分裂"><a href="#表格存储高性能-自动连续分裂" class="headerlink" title="表格存储高性能-自动连续分裂"></a>表格存储高性能-自动连续分裂</h3><p><img src="/2018/04/13/pangu/表格存储自动分裂.png" alt="表格存储自动分裂"></p>
<ul>
<li><p>1.表格存储支持连续的自动分裂（也是一种负责均衡的实现）。<br>由于表格存储使用第一个主键列分片，而且数据是按主键列排序的，所以在当分片过大或者过热时可以很容易的分片，再加上表格存储的数据分区是逻辑单位，实际的数据存储在盘古（共享存储的好处），所以在分裂时，不需要迁移数据，可以很快完成分裂。</p>
</li>
<li><p>2.由于表格存储是基于LSM(Log Structured Merge Trees)的，在数据写入或者更新的时候，会先写入commitlog进行持久化，然后再写入内存中的MemTable，MemTable会定期的flush成一个新的数据文件，后台定期对不同的数据文件进行合并，合并为一个更大的数据文件，并清理垃圾数据等。</p>
</li>
<li><p>3.表格存储一张表的每个分片都拥有独立的commitlog，每次修改的内容都会append写入commitlog。当节点故障时，内存中的MemTable还未flush成数据文件，此时发生failover，分片被另外的TableWorker加载，只需要重新replay一部分commitlog即可恢复MemTable，保证写入的数据不丢。</p>
</li>
</ul>
<h3 id="分布式存储系统-盘古"><a href="#分布式存储系统-盘古" class="headerlink" title="分布式存储系统-盘古"></a>分布式存储系统-盘古</h3><ul>
<li>高可靠<ul>
<li>多副本强一致</li>
<li>端到端的数据校验、静默错误的检查 </li>
</ul>
</li>
<li>高可用<ul>
<li>多租户隔离</li>
<li>基于Paxos的多组Master</li>
<li>Federation支持水平扩展</li>
</ul>
</li>
<li>高性能<ul>
<li>混合存储：SSD作为SATA盘Cache</li>
<li>内存零拷贝</li>
<li>数据处理流水线化增大吞吐</li>
</ul>
</li>
<li>低成本<ul>
<li>集群间共享数据</li>
<li>EC（Erasure Coding）等</li>
</ul>
</li>
</ul>
<h3 id="盘古架构"><a href="#盘古架构" class="headerlink" title="盘古架构"></a>盘古架构</h3><p><img src="/2018/04/13/pangu/盘古10架构图.png" alt="盘古10架构图"><br>三个模块：Master、Client、Chunk Server<br>了解HDFS实现的人应该很熟悉这个图，盘古同HDFS一样采用（主从）master/slave设计。一个存储集群是由一组Master和一定数目的Chunk Server组成，在数据读写时Client先请求Master获取到数据存储的元数据，之后的数据读写，Client就直接跟Chunk Server交互了。Chunk Server和Master保持心跳，向Master反馈数据状态以及接受Master的指令。大部分的分布式存储系统设计都差不多，其中OpenStack的Ceph区别较大，代表了分布式块存储设计的方向。</p>
<p>为了好理解，这里引用的是盘古1.0的设计图，盘古2.0主要的变化主要是Master节点在高可用上变化。</p>
<h3 id="盘古Master"><a href="#盘古Master" class="headerlink" title="盘古Master"></a>盘古Master</h3><p>对应HDFS的NameNode，负责元数据管理，最主要的就是维护两个映射关系：</p>
<ul>
<li>文件名到数据块；</li>
<li>数据块到Chunk Server列表。</li>
</ul>
<p>其中文件名到数据块的信息保存在磁盘上(持久化)；但Master不保存数据块到Chunk Server列表，这个是通过Chunk Server在启动时的上报数据块信息，更新Master上的映射表。<br>Master暴露了文件系统的名字空间，用户可以 以文件的形式在上面存储数据。<br>Master在分布式文件系统中需要解决的三个核心问题：</p>
<ul>
<li>容量以Federation方式水平扩展</li>
<li>高效数据流量动态规划实现最大吞吐</li>
<li>高可用：Paxos数据一致，防止单点</li>
</ul>
<h3 id="盘古Chunk-Server"><a href="#盘古Chunk-Server" class="headerlink" title="盘古Chunk Server"></a>盘古Chunk Server</h3><p>对应HDFS的DataNode，负责数据存储，一般是多台组成集群。<br>存储过程中，一个文件被分成一个或多个数据块(至少一个)，这些块存储在多个Chunk Server上，每块数据通过多副本来保证可靠性以及加快后期的读取速度。Chunk Server负责处理分布式文件系统客户端的实际的读写数据请求。在Master的统一调度下进行数据块的创建、删除和复制。</p>
<ul>
<li>三副本强一致<br>三副本位于不同的故障域（rack），故障时自动多点数据复制</li>
<li>端到端的数据校验，静默错误检查</li>
<li>心跳<br>与Master维护心跳，上报机器状态；接收Master指令；</li>
<li>混合存储提高写入性能、EC降低存储成本</li>
</ul>
<h3 id="Master扩展性"><a href="#Master扩展性" class="headerlink" title="Master扩展性"></a>Master扩展性</h3><p><strong> 可扩展：</strong> 不成为系统瓶颈，能随数据服务器数量的增多而线性扩展 </p>
<ul>
<li>元数据的容量不成为系统瓶颈 </li>
<li>服务请求能力不成为系统瓶颈 </li>
</ul>
<p><strong> 常用的实现方式：</strong></p>
<ul>
<li>Federation</li>
</ul>
<h3 id="盘古Master扩展性-Federation"><a href="#盘古Master扩展性-Federation" class="headerlink" title="盘古Master扩展性-Federation"></a>盘古Master扩展性-Federation</h3><p><img src="/2018/04/13/pangu/HDFS_Federation.png" alt="HDFS_Federation"><br>跟HDFS一样，基于Federation实现Master水平扩展。</p>
<p>Federation使用了多个独立的Namespace，namenode之间相互独立且不需要互相协调，各自分工，管理自己的区域。</p>
<p>分布式的datanode被用作通用的数据块存储存储设备。每个datanode要向集群中所有的namenode注册，且周期性地向所有namenode发送心跳和块报告，并执行来自所有namenode的命令。</p>
<p>一个block pool由属于同一个namespace的数据块组成，每个datanode可能会存储集群中所有block pool的数据块。每个block pool内部自治，也就是说各自管理各自的block，不会与其他block pool交流。一个namenode挂掉了，不会影响其他namenode。</p>
<p>某个namenode上的namespace和它对应的block pool一起被称为namespace volume(命名空间卷)。它是管理的基本单位。当一个namenode/nodespace被删除后，其所有datanode上对应的block pool也会被删除。当集群升级时，每个namespace volume作为一个基本单元进行升级。</p>
<h3 id="高可用实现方式"><a href="#高可用实现方式" class="headerlink" title="高可用实现方式"></a>高可用实现方式</h3><p><strong> 高可用 </strong> ：不成为故障单点</p>
<ul>
<li>多个备份，故障时快速切换</li>
<li>保证状态一致性</li>
</ul>
<p><strong> 常用的实现方式：</strong></p>
<ul>
<li>主从同步</li>
<li>分布式协议</li>
</ul>
<h3 id="高可用实现方式-主从模式"><a href="#高可用实现方式-主从模式" class="headerlink" title="高可用实现方式-主从模式"></a>高可用实现方式-主从模式</h3><p><img src="/2018/04/13/pangu/主从高可用.png" alt="主从高可用"><br>HDFS的实现方式，</p>
<ul>
<li>1）分布式锁互斥实现选主（ZK）</li>
<li>2）通过共享存储实现数据一致性，HDFS是使用NFS作为共享存储</li>
<li>3）通过心跳检测故障</li>
</ul>
<h3 id="盘古Master高可用实现方式-分布式协议"><a href="#盘古Master高可用实现方式-分布式协议" class="headerlink" title="盘古Master高可用实现方式-分布式协议"></a>盘古Master高可用实现方式-分布式协议</h3><p><img src="/2018/04/13/pangu/盘古paxos.png" alt="盘古paxos"></p>
<ul>
<li>1）使用Paxos一致性协商协议，保证高可用和快速切换</li>
<li>2）不依赖外部共享存储和互斥锁服务，独立自包含</li>
</ul>
<p>其实，了解到盘古是基于Raft协议实现的类Paxos协议。现在很多公司的分布式存储都采用Raft协议实现一致性，感兴趣的可以研究下。</p>
<p>Master高性能，通过使用Raid卡（或者闪存），提高Meta的读写性能。<br>由于raid卡是带cache，并且是有电池的，所以在掉电的情况下可以电池放电周期内不丢失数据，所以，master可以在写入raid卡后就返回客户端成功，后台离线将缓存中的数据刷入后端SATA硬盘中。</p>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>默刀</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://blog.7street.top/2018/04/13/pangu/" title="阿里云分布式存储系统的研究与分享">http://blog.7street.top/2018/04/13/pangu/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/分布式/" rel="tag"># 分布式</a>
          
            <a href="/tags/系统设计/" rel="tag"># 系统设计</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/27/tc/" rel="next" title="Linux TC限流">
                <i class="fa fa-chevron-left"></i> Linux TC限流
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/16/io-model/" rel="prev" title="四种基本的I/O模型">
                四种基本的I/O模型 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/touxiang.png"
                alt="默刀" />
            
              <p class="site-author-name" itemprop="name">默刀</p>
              <p class="site-description motion-element" itemprop="description">潜心积累、野蛮成长</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">45</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/polarisary" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:polarisary@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cnzengwei" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i>微博</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                牛人站点
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://coolshell.cn/" title="酷壳 - CoolShell" target="_blank">酷壳 - CoolShell</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://rushter.com/blog/" title="Artem Golubin" target="_blank">Artem Golubin</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://jolestar.com/" title="午夜咖啡" target="_blank">午夜咖啡</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#云计算介绍"><span class="nav-number">1.</span> <span class="nav-text">云计算介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#阿里云计算"><span class="nav-number">2.</span> <span class="nav-text">阿里云计算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#飞天开发平台"><span class="nav-number">3.</span> <span class="nav-text">飞天开发平台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分布式存储"><span class="nav-number">4.</span> <span class="nav-text">分布式存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据存储产品"><span class="nav-number">5.</span> <span class="nav-text">数据存储产品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#弹性块存储EBS"><span class="nav-number">6.</span> <span class="nav-text">弹性块存储EBS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表格存储TableStore"><span class="nav-number">7.</span> <span class="nav-text">表格存储TableStore</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表格存储系统架构"><span class="nav-number">8.</span> <span class="nav-text">表格存储系统架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表格存储高可用—Failover"><span class="nav-number">9.</span> <span class="nav-text">表格存储高可用—Failover</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表格存储高性能-自动连续分裂"><span class="nav-number">10.</span> <span class="nav-text">表格存储高性能-自动连续分裂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分布式存储系统-盘古"><span class="nav-number">11.</span> <span class="nav-text">分布式存储系统-盘古</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盘古架构"><span class="nav-number">12.</span> <span class="nav-text">盘古架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盘古Master"><span class="nav-number">13.</span> <span class="nav-text">盘古Master</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盘古Chunk-Server"><span class="nav-number">14.</span> <span class="nav-text">盘古Chunk Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Master扩展性"><span class="nav-number">15.</span> <span class="nav-text">Master扩展性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盘古Master扩展性-Federation"><span class="nav-number">16.</span> <span class="nav-text">盘古Master扩展性-Federation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#高可用实现方式"><span class="nav-number">17.</span> <span class="nav-text">高可用实现方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#高可用实现方式-主从模式"><span class="nav-number">18.</span> <span class="nav-text">高可用实现方式-主从模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#盘古Master高可用实现方式-分布式协议"><span class="nav-number">19.</span> <span class="nav-text">盘古Master高可用实现方式-分布式协议</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2014 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">默刀</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.4.4</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.3.0</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://默刀.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://blog.7street.top/2018/04/13/pangu/';
        this.page.identifier = '2018/04/13/pangu/';
        this.page.title = '阿里云分布式存储系统的研究与分享';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://默刀.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  





	





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
